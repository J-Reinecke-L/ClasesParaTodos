<!DOCTYPE HTML>
<html>

<head>
    <title>Clases para todos</title>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="estilos.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body style="background-color: lightsteelblue;">
    <div>
        <br><br><br>
        <div class="container" style="max-width: 15%; position: absolute; top: 15%; left: 0%; cursor: pointer;">
            <div class="border border-3 p-1" style="text-align: center;" onclick="location.href='main.html';">
                <h5 style="color: azure;">Regresar</h5>
            </div>
        </div>
        <br>
        <div class="container" style="max-width: fit-content; text-align: center;">
            <img src="un_logo_simple_y_alucivo_a_la_solidaridad_y_ayuda_en_el_contexto_de_la_educaci√≥n-removebg-preview.png"
                alt="">
            <h3 style="color: aliceblue;">Registro de estudiantes</h3>
        </div>
        <br>
        <div class="container" style="margin-left: auto; margin-right: auto; max-width: 50%;">
            <h4 style="color: aliceblue; text-align: center;">Agregar Estudiante</h4>
            <form id="crearEstudianteForm">
                <br>
                <input type="text" id="clase" class="form-control" placeholder="Nombre de la clase">
                <br>
                <input type="text" id="nombre" name="nombre" class="form-control" placeholder="Nombre del estudiante"
                    required>
                <br>

                <h5 style="color: aliceblue;">Caracter√≠sticas encontradas:</h5>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="atencion" name="caracteristicas"
                        value="Dificultades de atenci√≥n">
                    <label class="form-check-label" style="color: aliceblue;" for="atencion">Dificultades de
                        atenci√≥n</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="social" name="caracteristicas"
                        value="Desaf√≠os sociales y de comunicaci√≥n">
                    <label class="form-check-label" style="color: aliceblue;" for="social">Desaf√≠os sociales y de
                        comunicaci√≥n</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="dislexia" name="caracteristicas"
                        value="Dificultades de lectura y escritura">
                    <label class="form-check-label" style="color: aliceblue;" for="dislexia">Dificultades de lectura y
                        escritura</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="discalculia" name="caracteristicas"
                        value="Dificultades matem√°ticas">
                    <label class="form-check-label" style="color: aliceblue;" for="discalculia">Dificultades
                        matem√°ticas</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="dispraxia" name="caracteristicas"
                        value="Dificultades motoras o de coordinaci√≥n">
                    <label class="form-check-label" style="color: aliceblue;" for="dispraxia">Dificultades motoras o de
                        coordinaci√≥n</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="tourette" name="caracteristicas"
                        value="Tics o movimientos involuntarios">
                    <label class="form-check-label" style="color: aliceblue;" for="tourette">Tics o movimientos
                        involuntarios</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="visual" name="caracteristicas"
                        value="Discapacidad visual">
                    <label class="form-check-label" style="color: aliceblue;" for="visual">Discapacidad visual</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="auditiva" name="caracteristicas"
                        value="Discapacidad auditiva">
                    <label class="form-check-label" style="color: aliceblue;" for="auditiva">Discapacidad
                        auditiva</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="sensorial" name="caracteristicas"
                        value="Dificultades en el procesamiento sensorial">
                    <label class="form-check-label" style="color: aliceblue;" for="sensorial">Dificultades en el
                        procesamiento sensorial</label>
                </div>

                <br>
                <button class="btn btn-success border border-3 p-1" type="submit">Registrar Estudiante</button>
            </form>
        </div>

        <br>
        <div class="container" style="margin-left: auto; margin-right: auto; max-width: 50%;">
            <input type="text" id="busqueda" class="form-control" placeholder="Buscar" onkeyup="filtrarEstudiantes()">
        </div>


        <br>



        <div class="container" style="margin-left: auto; margin-right: auto; max-width: 60%;">
            <div class="row">
                <table class="table table-bordered table-dark table-hover">
                    <thead>
                        <tr style="text-align: center;">
                            <th>Clases</th>
                            <th>Nombre</th>
                            <th>Caracteristicas encontradas</th>
                            <th>Recomendaciones</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>

                    <tbody id="listaEstudiantes"></tbody> <!-- Aqu√≠ se insertar√°n los estudiantes -->
                </table>
            </div>
        </div>
        <div class="container s-5" style="position: absolute; bottom: 5%; left: 0;">
            <a href="sobre nosotros.html" style="color: azure;">sobre nosotros</a>
        </div>
    </div>
    <!-- Modal para editar estudiante -->
    <div id="editarModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Editar Estudiante</h2>
            <label>Nombre:</label>
            <input type="text" id="editarNombre">
            <label for="editarClases">Clases:</label>
            <input type="text" id="editarClases">
            <h3>Caracter√≠sticas encontradas:</h3>
            <div id="editarCaracteristicas"></div>
            <button id="guardarEdicion">Guardar Cambios</button>


        </div>
    </div>

    <style>
        .modal {
            display: none;
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            margin: 10% auto;
            width: 50%;
        }

        .close {
            float: right;
            font-size: 28px;
            cursor: pointer;
        }
    </style>

</body>
<script>
    document.getElementById('crearEstudianteForm').addEventListener('submit', function (event) {
    event.preventDefault();

    const nombre = document.getElementById('nombre').value.trim();
    const checkboxes = document.querySelectorAll('input[name="caracteristicas"]:checked');
    const caracteristicas = Array.from(checkboxes).map(cb => cb.value);
    const usuarioId = localStorage.getItem("usuarioId");

    // üëá Convertir la entrada de `clase` en un array para que coincida con el esquema
    let clases = document.getElementById('clase').value.trim();
    clases = clases.length > 0 ? [clases] : [];  // üîπ Si hay texto, convi√©rtelo en un array

    if (!usuarioId || usuarioId.length !== 24) {
        alert("Error: Usuario no autenticado. Inicia sesi√≥n nuevamente.");
        return;
    }

    console.log("‚úÖ Datos que se enviar√°n:", { nombre, caracteristicas, usuarioId, clases });

    fetch('/crear-estudiante', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ nombre, caracteristicas, usuarioId, clases })
    })
    .then(async (response) => {
        const data = await response.json();
        console.log("üì© Respuesta del servidor:", data);
        alert(data.mensaje);
        document.getElementById('crearEstudianteForm').reset();
        location.reload();
    })
    .catch((error) => {
        console.error('‚ùå Error al registrar estudiante:', error);
        alert("Error interno. Por favor, intenta nuevamente.");
    });
});



</script>

<script>
    function filtrarEstudiantes() {
        const input = document.getElementById("busqueda").value.toLowerCase();
        const filas = document.querySelectorAll("#listaEstudiantes tr");

        filas.forEach(fila => {
            const nombre = fila.children[1].textContent.toLowerCase();
            const clases = fila.children[0].textContent.toLowerCase();
            const caracteristicas = fila.children[2].textContent.toLowerCase();

            if (nombre.includes(input) || clases.includes(input) || caracteristicas.includes(input)) {
                fila.style.display = "";
            } else {
                fila.style.display = "none";
            }
        });
    }


</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const usuarioId = localStorage.getItem("usuarioId");

        if (!usuarioId || usuarioId.length !== 24) {
            alert("Error: Usuario no autenticado. Inicia sesi√≥n nuevamente.");
            return;
        }

        const recomendacionesPorCaracteristica = {
            "Dificultades de atenci√≥n": [
                "Ubicar cerca del docente y reducir distracciones.",
                "Usar ayudas visuales y actividades din√°micas.",
                "Permitir pausas activas para mejorar concentraci√≥n."
            ],
            "Desaf√≠os sociales y de comunicaci√≥n": [
                "Fomentar trabajo en equipo y comunicaci√≥n clara.",
                "Crear un ambiente seguro para la interacci√≥n."
            ],
            "Dificultades de lectura y escritura": [
                "Usar textos m√°s claros y permitir lectura guiada.",
                "Ofrecer opciones de respuesta oral en lugar de escrita."
            ],
            "Dificultades matem√°ticas": [
                "Explicar con objetos f√≠sicos y ejemplos cotidianos.",
                "Dividir los problemas en pasos simples."
            ],
            "Dificultades motoras o de coordinaci√≥n": [
                "Adaptar materiales para facilitar escritura y movimiento.",
                "Ofrecer apoyo tecnol√≥gico si es necesario."
            ],
            "Tics o movimientos involuntarios": [
                "Evitar situaciones de estr√©s y fomentar comprensi√≥n.",
                "Permitir pausas y t√©cnicas de relajaci√≥n."
            ],
            "Discapacidad visual": [
                "Usar textos con letras grandes y alto contraste.",
                "Describir verbalmente im√°genes y gr√°ficos."
            ],
            "Discapacidad auditiva": [
                "Usar subt√≠tulos en videos y hablar de frente al estudiante.",
                "Fomentar el uso de materiales visuales y apoyos escritos."
            ],
            "Dificultades en el procesamiento sensorial": [
                "Reducir luces brillantes y sonidos fuertes.",
                "Permitir objetos de estimulaci√≥n sensorial."
            ]
        };

        fetch(`/estudiantes/${usuarioId}`)
            .then(async (response) => {
                if (!response.ok) {
                    throw new Error("Error al obtener estudiantes.");
                }
                const estudiantes = await response.json();
                const lista = document.getElementById("listaEstudiantes");
                lista.innerHTML = "";

                estudiantes.forEach(estudiante => {
                    console.log("‚úÖ Estudiante obtenido:", estudiante); // Verificar datos

                    // Generar recomendaciones basadas en las caracter√≠sticas del estudiante
                    const recomendaciones = [];
                    estudiante.caracteristicas.forEach(caracteristica => {
                        if (recomendacionesPorCaracteristica[caracteristica]) {
                            recomendaciones.push(...recomendacionesPorCaracteristica[caracteristica]);
                        }
                    });

                    const fila = document.createElement("tr");

                    fila.innerHTML = `
                <td>${estudiante.clases && estudiante.clases.length > 0 ? estudiante.clases.join(", ") : "No asignado"}</td>
                <td>${estudiante.nombre}</td>
                <td>${estudiante.caracteristicas ? estudiante.caracteristicas.join(", ") : "No registrado"}</td>
                <td>${recomendaciones.length > 0 ? recomendaciones.join('<br>') : "No disponible"}</td> <!-- üëà Ahora se llenan las recomendaciones -->
                <td>
                    <button class="btn btn-warning btn-sm" onclick="editarEstudiante('${estudiante._id}', '${estudiante.nombre}', '${estudiante.caracteristicas ? estudiante.caracteristicas.join(", ") : ""}', '${estudiante.clases ? estudiante.clases.join(", ") : ""}')">‚úèÔ∏è Modificar</button>
                    <button class="btn btn-danger btn-sm" onclick="eliminarEstudiante('${estudiante._id}')">üóëÔ∏è Eliminar</button>
                </td>
            `;

                    lista.appendChild(fila);
                });
            })
            .catch(error => console.error("Error al cargar estudiantes:", error));
    });

</script>

<script>
    function editarEstudiante(id, nombreActual, caracteristicasActuales, clasesActuales) {
        estudianteIdEdicion = id;
        document.getElementById("editarNombre").value = nombreActual;

        const caracteristicas = [
            "Dificultades de atenci√≥n", "Desaf√≠os sociales y de comunicaci√≥n", "Dificultades de lectura y escritura",
            "Dificultades matem√°ticas", "Dificultades motoras o de coordinaci√≥n", "Tics o movimientos involuntarios",
            "Discapacidad visual", "Discapacidad auditiva", "Dificultades en el procesamiento sensorial"
        ];

        const contenedorCaracteristicas = document.getElementById("editarCaracteristicas");
        contenedorCaracteristicas.innerHTML = "";

        caracteristicas.forEach(caracteristica => {
            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.value = caracteristica;
            checkbox.checked = caracteristicasActuales.includes(caracteristica);

            const label = document.createElement("label");
            label.textContent = caracteristica;
            contenedorCaracteristicas.appendChild(checkbox);
            contenedorCaracteristicas.appendChild(label);
            contenedorCaracteristicas.appendChild(document.createElement("br"));
        });

        // üî• Asegurar que `clasesActuales` siempre sea un array antes de `.join()`
        let clasesArray = [];
        if (Array.isArray(clasesActuales)) {
            clasesArray = clasesActuales;
        } else if (typeof clasesActuales === "string") {
            clasesArray = clasesActuales.split(",").map(c => c.trim());
        }

        console.log("üì© Clases actuales para edici√≥n:", clasesArray); // üëà Verificar lo que se est√° asignando
        document.getElementById("editarClases").value = clasesArray.join(", ");

        document.getElementById("editarModal").style.display = "block";
    }

</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const botonGuardar = document.getElementById("guardarEdicion");
        if (!botonGuardar) {
            console.error("No se encontr√≥ el bot√≥n 'guardarEdicion'. Verifica el ID en el HTML.");
            return;
        }
        botonGuardar.addEventListener("click", function () {
            const nuevoNombre = document.getElementById("editarNombre").value.trim();
            const nuevasCaracteristicas = [...document.querySelectorAll("#editarCaracteristicas input:checked")].map(cb => cb.value);
            const nuevasClases = document.getElementById("editarClases").value.trim().split(",").map(c => c.trim());

            console.log("üì© Datos que se enviar√°n:");
            console.log("üîπ Nombre:", nuevoNombre);
            console.log("üîπ Caracter√≠sticas:", nuevasCaracteristicas);
            console.log("üîπ Clases:", nuevasClases);

            fetch(`/editar-estudiante/${estudianteIdEdicion}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ nombre: nuevoNombre, caracteristicas: nuevasCaracteristicas, clases: nuevasClases })
            })
                .then(async (response) => {
                    const data = await response.text();
                    console.log("Respuesta del servidor:", data);
                    alert(data);
                    location.reload();
                })
                .catch(error => {
                    console.error("Error al editar estudiante:", error);
                    alert("Error interno al editar estudiante.");
                });
        });



    });

</script>

<script>
    function eliminarEstudiante(id) {
        if (confirm("¬øEst√°s seguro de que quieres eliminar este estudiante?")) {
            fetch(`/eliminar-estudiante/${id}`, {
                method: "DELETE",
            })
                .then(response => response.json())
                .then(resultado => {
                    if (resultado.exito) {
                        alert("Estudiante eliminado exitosamente.");

                        // üîπ Recargar la p√°gina para actualizar la tabla autom√°ticamente
                        location.reload();
                    } else {
                        alert(`Error al eliminar estudiante: ${resultado.mensaje}`);
                    }
                })
                .catch(error => console.error("Error al eliminar estudiante:", error));
        }
    }



</script>

</html>